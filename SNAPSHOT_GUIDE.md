# 🔄 מדריך שמירה ושחזור מצב מערכת

## סקירה כללית

מנגנון שמירה ושחזור מצב מלא של הלקוח במערכת. מאפשר:
- 💾 **שמירה** - יצירת snapshot של כל נתוני הלקוח
- ♻️ **שחזור** - החזרת המערכת למצב שמור

---

## מה נשמר?

הכפתור **💾 שמור מצב** שומר את כל הנתונים הבאים:

| קטגוריה | פריטים |
|---------|--------|
| **קצבאות** | כל קרנות הפנסיה, קופות הגמל, ביטוחי מנהלים |
| **נכסי הון** | נדל"ן, השקעות, חיסכון, פיצויים |
| **הכנסות נוספות** | הכנסות מעבודה, דיבידנדים, שכירות |
| **מעסיק נוכחי** | פרטי מעביד, תאריכים, שכר |
| **מענקים** | כל המענקים (פיצויים, פרישה, חניכה) |
| **עזיבת עבודה** | תאריך פרישה, סכומים, בחירות |
| **קיבוע זכויות** | תוצאות קיבוע (אם קיימות) |

---

## איך משתמשים?

### 1️⃣ שמירת מצב

```
1. היכנס לדף הלקוח
2. מצא את הקופסה "🔄 שמירה ושחזור מצב מערכת"
3. לחץ על כפתור "💾 שמור מצב"
4. המערכת תשמור את כל הנתונים ב-localStorage
```

**תוצאה:**
```
✅ נשמרו 42 פריטים בהצלחה
נשמר: 17/10/2025, 19:30
```

---

### 2️⃣ שחזור מצב

```
1. לחץ על כפתור "♻️ שחזר מצב"
2. תיפתח חלונית אישור עם:
   - תאריך השמירה
   - אזהרה שהפעולה בלתי הפיכה
3. לחץ "אשר שחזור"
4. המערכת תמחק את כל הנתונים הנוכחיים
5. המערכת תשחזר את הנתונים מה-snapshot
6. הדף יתרענן אוטומטית
```

**⚠️ אזהרה:**
> שחזור מצב מוחק את **כל השינויים** שנעשו מאז השמירה!

---

## תרחישי שימוש

### 🎯 תרחיש 1: ניסוי תרחישים
```
1. שמור מצב לפני ביצוע תרחיש
2. בצע תרחיש 1 (מקסימום קצבה)
3. בדוק את התוצאות
4. שחזר מצב
5. בצע תרחיש 2 (מקסימום הון)
6. השווה תוצאות
```

### 🎯 תרחיש 2: גיבוי לפני שינוי גדול
```
1. שמור מצב לפני קיבוע זכויות
2. בצע קיבוע
3. אם יש בעיה - שחזר מצב
```

### 🎯 תרחיש 3: בדיקת אפקט של שינוי
```
1. שמור מצב
2. שנה את עזיבת העבודה (קצבה ← הון)
3. בדוק את האפקט על התרחישים
4. שחזר מצב אם לא מרוצה
```

---

## פרטים טכניים

### איפה הנתונים נשמרים?

**LocalStorage** בדפדפן:
- Key: `snapshot_client_{client_id}`
- Format: JSON
- גודל: ~10-50 KB לכל לקוח

**⚠️ חשוב:**
- הנתונים נשמרים **בדפדפן** בלבד
- ניקוי cache/cookies ימחק את השמירות
- לא משותף בין מכשירים שונים

### API Endpoints

#### שמירה
```
POST /api/v1/clients/{client_id}/snapshot/save
Body: { "snapshot_name": "שם אופציונלי" }
```

#### שחזור
```
POST /api/v1/clients/{client_id}/snapshot/restore
Body: { <snapshot_data> }
```

#### מידע
```
GET /api/v1/clients/{client_id}/snapshot/info
```

---

## שאלות נפוצות

### ❓ האם אפשר לשמור כמה snapshots?
לא, רק snapshot אחד פר לקוח. כל שמירה חדשה דורסת את הקודמת.

### ❓ מה קורה אם אני מנקה את ה-cache?
הSnapshot נמחק. צריך לשמור מחדש.

### ❓ האם שחזור משפיע על לקוחות אחרים?
לא! כל snapshot ספציפי ללקוח אחד בלבד.

### ❓ האם אפשר לבטל שחזור?
לא! לכן מומלץ לשמור מצב חדש **לפני** שחזור אם יש נתונים חשובים.

### ❓ מה קורה לתרחישים שמורים?
תרחישים שמורים (Scenario DB records) **לא נמחקים** בשחזור.  
רק הנתונים האקטיביים (קצבאות, הון וכו') משתנים.

---

## דוגמת תרשים זרימה

```
┌─────────────────────────────────────┐
│  💾 שמור מצב                        │
├─────────────────────────────────────┤
│  1. איסוף כל הנתונים מ-DB          │
│  2. Serialization ל-JSON           │
│  3. שמירה ב-localStorage            │
│                                     │
│  ✅ 42 פריטים נשמרו                │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  ⚡ ביצוע תרחיש / שינויים           │
├─────────────────────────────────────┤
│  • יצירת קצבאות חדשות              │
│  • היוונים                          │
│  • המרות                            │
│  • עדכון ערכים                      │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  ♻️ שחזר מצב                        │
├─────────────────────────────────────┤
│  1. קריאת snapshot מ-localStorage   │
│  2. מחיקת כל הנתונים הנוכחיים      │
│  3. שחזור מה-snapshot                │
│  4. רענון הדף                       │
│                                     │
│  ✅ חזרה למצב המקורי               │
└─────────────────────────────────────┘
```

---

## קבצים רלוונטיים

### Backend
- `app/services/snapshot_service.py` - לוגיקת שמירה/שחזור
- `app/routers/snapshot.py` - API endpoints
- `app/main.py` - רישום router

### Frontend
- `frontend/src/components/SystemSnapshot.tsx` - קומפוננטת UI
- `frontend/src/pages/ClientDetails.tsx` - שילוב בדף לקוח

---

## הערות פיתוח עתידיות

### שיפורים אפשריים:
1. 📦 **Multiple Snapshots** - שמירת כמה גרסאות
2. ☁️ **Server Storage** - שמירה בשרת במקום localStorage
3. 📤 **Export/Import** - יצוא/יבוא snapshots לקובץ
4. 🔍 **Diff View** - השוואה בין snapshot לנוכחי
5. ⏰ **Auto-Snapshot** - שמירה אוטומטית לפני פעולות קריטיות

---

**🚀 המערכת מוכנה לשימוש!**
