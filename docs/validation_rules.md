# מערכת תכנון פרישה - כללי תיקוף ואימות נתונים
# Retirement Planning System - Validation Rules and Assumptions

## כללי תיקוף לישות לקוח (Client Entity Validation Rules)

### מספר זהות (ID Number)
- **חובה**: כן
- **תיקוף**:
  - חייב להיות מספר זהות ישראלי תקין עם ספרת ביקורת
  - אורך: 9 ספרות (כולל אפסים מובילים)
  - נורמליזציה: הסרת תווים שאינם ספרות, הוספת אפסים מובילים
  - בדיקת תקינות: אלגוריתם ספרת ביקורת ישראלי
- **דוגמאות תקינות**: `123456782`, `305567663`
- **דוגמאות לא תקינות**: `123456789` (ספרת ביקורת שגויה), `12345678` (קצר מדי)
- **הודעת שגיאה**: "תעודת זהות אינה תקינה"

### שם מלא (Full Name)
- **חובה**: כן
- **תיקוף**:
  - אורך מינימלי: 2 תווים
  - נורמליזציה: הסרת רווחים מיותרים, נורמליזציית Unicode NFC
- **דוגמאות תקינות**: `ישראל ישראלי`, `שרה כהן`
- **דוגמאות לא תקינות**: `י` (קצר מדי)
- **הודעת שגיאה**: "שם מלא הינו שדה חובה" או "שם מלא חייב להכיל לפחות 2 תווים"

### שם פרטי ושם משפחה (First Name, Last Name)
- **חובה**: לא
- **תיקוף**:
  - נורמליזציה: הסרת רווחים מיותרים, נורמליזציית Unicode NFC
- **הודעת שגיאה**: אין (שדות אופציונליים)

### תאריך לידה (Birth Date)
- **חובה**: כן
- **תיקוף**:
  - פורמט: ISO 8601 (YYYY-MM-DD)
  - גיל מינימלי: 18 שנים
  - גיל מקסימלי: 120 שנים
- **דוגמאות תקינות**: תאריך בין לפני 18-120 שנים מהיום
- **דוגמאות לא תקינות**: תאריך עתידי, תאריך לפני 121 שנים, תאריך לפני פחות מ-18 שנים
- **הודעת שגיאה**: "תאריך לידה לא הגיוני - גיל מינימלי הוא 18" או "תאריך לידה לא הגיוני - גיל מקסימלי הוא 120"

### מגדר (Gender)
- **חובה**: לא
- **תיקוף**:
  - ערכים מותרים: `male`, `female`, `other`
- **הודעת שגיאה**: "ערך לא חוקי עבור מגדר"

### מצב משפחתי (Marital Status)
- **חובה**: לא
- **תיקוף**:
  - ערכים מותרים: `single`, `married`, `divorced`, `widowed`, `separated`
- **הודעת שגיאה**: "ערך לא חוקי עבור מצב משפחתי"

### דגלי תעסוקה (Employment Flags)
- **חובה**: לא
- **תיקוף**:
  - `self_employed` ו-`current_employer_exists` לא יכולים להיות שניהם `true`
  - אם `current_employer_exists` הוא `true`, אז `planned_termination_date` יכול להיות מוגדר
  - אם `current_employer_exists` הוא `false`, אז `planned_termination_date` חייב להיות ריק
- **הודעת שגיאה**: "לקוח לא יכול להיות גם עצמאי וגם שכיר" או "תאריך סיום העסקה יכול להיות מוגדר רק אם קיים מעסיק נוכחי"

### תאריך סיום העסקה מתוכנן (Planned Termination Date)
- **חובה**: לא
- **תיקוף**:
  - פורמט: ISO 8601 (YYYY-MM-DD)
  - חייב להיות היום או בעתיד
  - חייב להיות ריק אם `current_employer_exists` הוא `false`
- **הודעת שגיאה**: "תאריך סיום העסקה חייב להיות היום או בעתיד"

### פרטי קשר (Contact Information)
- **חובה**: לא
- **תיקוף**:
  - אימייל: פורמט תקין של כתובת אימייל
  - טלפון: מותרים ספרות, מקף, רווח, וסימן פלוס
- **נורמליזציה**:
  - אימייל: המרה לאותיות קטנות
  - טלפון: שמירה על ספרות, מקף, רווח, וסימן פלוס
- **הודעת שגיאה**: "כתובת אימייל לא תקינה"

### כתובת (Address)
- **חובה**: לא
- **תיקוף**:
  - נורמליזציה: הסרת רווחים מיותרים, נורמליזציית Unicode NFC
- **הודעת שגיאה**: אין (שדות אופציונליים)

### תאריך יעד לפרישה (Retirement Target Date)
- **חובה**: לא
- **תיקוף**:
  - פורמט: ISO 8601 (YYYY-MM-DD)
  - חייב להיות היום או בעתיד
- **הודעת שגיאה**: "תאריך יעד לפרישה חייב להיות היום או בעתיד"

### סטטוס פעיל (Active Status)
- **חובה**: כן
- **תיקוף**:
  - ערך בוליאני (`true` או `false`)
- **הודעת שגיאה**: "סטטוס פעיל הינו שדה חובה"

### הערות (Notes)
- **חובה**: לא
- **תיקוף**:
  - נורמליזציה: הסרת רווחים מיותרים, נורמליזציית Unicode NFC
- **הודעת שגיאה**: אין (שדה אופציונלי)

## כללי נורמליזציה (Normalization Rules)

### טקסט (Text)
- הסרת רווחים מיותרים בתחילה ובסוף
- דחיסת רווחים מרובים לרווח בודד
- נורמליזציית Unicode NFC לתמיכה בעברית

### מספר זהות (ID Number)
- הסרת תווים שאינם ספרות
- הוספת אפסים מובילים עד לאורך של 9 ספרות

### אימייל (Email)
- המרה לאותיות קטנות

### טלפון (Phone)
- שמירה על ספרות, מקף, רווח, וסימן פלוס
- הסרת תווים אחרים

## התנהגות API (API Behavior)

### יצירת לקוח (POST /api/v1/clients)
- **קוד הצלחה**: 201 Created
- **תוכן תשובה**: אובייקט לקוח מלא כולל ID
- **שגיאות אפשריות**:
  - 422 Unprocessable Entity: נתונים לא תקינים
  - 409 Conflict: מספר זהות כבר קיים במערכת

### קבלת לקוח (GET /api/v1/clients/{id})
- **קוד הצלחה**: 200 OK
- **תוכן תשובה**: אובייקט לקוח מלא
- **שגיאות אפשריות**:
  - 404 Not Found: לקוח לא נמצא

### עדכון לקוח (PATCH /api/v1/clients/{id})
- **קוד הצלחה**: 200 OK
- **תוכן תשובה**: אובייקט לקוח מעודכן
- **שגיאות אפשריות**:
  - 404 Not Found: לקוח לא נמצא
  - 422 Unprocessable Entity: נתונים לא תקינים

### מחיקת לקוח (DELETE /api/v1/clients/{id})
- **קוד הצלחה**: 204 No Content
- **תוכן תשובה**: ריק
- **שגיאות אפשריות**:
  - 404 Not Found: לקוח לא נמצא

### רשימת לקוחות (GET /api/v1/clients)
- **קוד הצלחה**: 200 OK
- **תוכן תשובה**: רשימת לקוחות עם פרמטרים לדפדוף
- **פרמטרים אפשריים**:
  - `skip`: מספר הרשומות לדילוג (ברירת מחדל: 0)
  - `limit`: מספר הרשומות להחזרה (ברירת מחדל: 100)
  - `sort`: שדה למיון (ברירת מחדל: id)
  - `order`: סדר המיון (asc/desc, ברירת מחדל: asc)
  - `is_active`: סינון לפי סטטוס פעיל (true/false)
  - `gender`: סינון לפי מגדר
  - `search`: חיפוש טקסט חופשי

## תיקוף בצד לקוח (Frontend Validation)

### תיקוף בזמן אמת (Real-time Validation)
- תיקוף מספר זהות: בדיקת ספרת ביקורת
- מסיכת קלט למספר זהות: רק ספרות, מקסימום 9 ספרות
- תיקוף תאריך לידה: בדיקת גיל מינימלי ומקסימלי
- תיקוף תאריך סיום העסקה: נראה רק אם יש מעסיק נוכחי, חייב להיות היום או בעתיד
- תיקוף תאריך יעד לפרישה: חייב להיות היום או בעתיד
- תיקוף פורמט אימייל

### הודעות שגיאה (Error Messages)
- הודעות שגיאה בעברית לכל שדה
- הצגת שגיאות ספציפיות לשדה
- הצגת שגיאות כלליות מהשרת

### התנהגות טופס (Form Behavior)
- מניעת שליחת טופס עם נתונים לא תקינים
- הצגת אינדיקטור טעינה בזמן שליחת הטופס
- השבתת כפתור שליחה בזמן שליחת הטופס
- הצגת הודעת הצלחה עם מזהה הלקוח לאחר יצירה מוצלחת
- איפוס הטופס לאחר יצירה מוצלחת

## הנחות כלליות (General Assumptions)

### שפה (Language)
- הודעות שגיאה בעברית
- תמיכה מלאה בעברית בכל השדות הטקסטואליים
- כיוון טקסט מימין לשמאל (RTL) בממשק המשתמש

### אבטחה (Security)
- אין אימות משתמשים או הרשאות בשלב זה
- כל הפעולות מותרות לכל המשתמשים

### קידוד (Encoding)
- UTF-8 לכל הקלטים והפלטים
- נורמליזציית Unicode NFC לתמיכה בעברית

### תאריכים (Dates)
- פורמט ISO 8601 (YYYY-MM-DD) לכל התאריכים
- אחסון בפורמט date בבסיס הנתונים
- תיקוף לוגי לפי הקשר (גיל, תאריכים עתידיים וכו')

### מספרים (Numbers)
- מספר זהות: מחרוזת של 9 ספרות
- מיקוד: מחרוזת של עד 10 תווים

### מזהים (IDs)
- מזהה לקוח: bigint אוטומטי
- מספר זהות: מחרוזת מנורמלת של 9 ספרות

## סיכום (Summary)

מסמך זה מפרט את כללי התיקוף והנורמליזציה עבור ישות הלקוח במערכת תכנון הפרישה. הכללים מיושמים הן בצד השרת (באמצעות FastAPI ו-Pydantic) והן בצד הלקוח (באמצעות JavaScript). המטרה היא להבטיח עקביות ותקינות הנתונים לאורך כל המערכת, תוך מתן משוב ברור למשתמש בעברית.
